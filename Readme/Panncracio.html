<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>츼rbol de Amor Animado</title>
    <meta name="author" content="Zero">
    <meta name="copyright" content="Zero - C칩digo libre no comercial">
    <meta name="description" content="츼rbol de Amor Animado: una sorpresa interactiva y rom치ntica.">
    
    <style>
        /* --- ESTILOS GENERALES (style.css incorporado) --- */
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #fcfcfc;
            font-size: 16px;
        }

        .tree-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 520px;
            height: 520px;
            z-index: 2;
        }

        .tree-container svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .tree-container svg path {
            transition: fill-opacity 0.5s, stroke-dashoffset 1.2s;
        }

        .tree-container svg.move-and-scale {
            transition: transform 1.2s cubic-bezier(.77,0,.18,1);
            transform: translateX(200px) scale(1.35);
        }

        .animated-heart {
            transform-origin: center;
            animation: beat 1s infinite;
        }

        @keyframes beat {
            0%, 100% { transform: scale(1); }
            20% { transform: scale(1.1); }
            40% { transform: scale(0.95); }
            60% { transform: scale(1.08); }
            80% { transform: scale(1); }
        }

        .dedication-text {
            position: absolute;
            top: 50%;
            left: 3%;
            transform: translateY(-50%);
            min-width: 320px;
            max-width: 600px;
            font-size: 1.5rem;
            color: #050505;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-line;
            z-index: 3;
            opacity: 0;
            pointer-events: none;
            background: rgba(255,255,255,0.92);
            border-radius: 0.7em;
            box-shadow: 0 2px 16px #e6002611;
            padding: 1em 1.5em;
            transition: opacity 0.6s;
        }

        .dedication-text.typing {
            opacity: 1;
        }

        .signature {
            margin-top: 1.5em;
            font-family: 'Courier New', Courier, monospace; /* O 'Dancing Script' si usas Google Fonts */
            font-size: 2.2rem;
            color: #e60026;
            opacity: 0;
            transition: opacity 0.7s;
        }

        .signature.visible {
            opacity: 1;
            animation: signature-draw 2.2s steps(24) forwards;
        }

        @keyframes signature-draw {
            from { clip-path: inset(0 100% 0 0); }
            to   { clip-path: inset(0 0 0 0); }
        }

        .countdown {
            position: fixed;
            left: 50%;
            bottom: 3%;
            transform: translateX(-50%) translateY(30px);
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.6rem;
            color: #333;
            background: #fff8;
            padding: 0.4em 1em;
            border-radius: 1em;
            z-index: 6;
            text-align: center;
            opacity: 0;
            transition: all 0.8s cubic-bezier(.77,0,.18,1);
        }

        .countdown.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        #floating-objects {
            position: fixed;
            left: 0; top: 0;
            width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 10;
        }

        .floating-petal {
            position: absolute;
            width: 24px; height: 32px;
            background: radial-gradient(ellipse at 60% 30%, #ffd6e0 60%, #ff69b4 100%);
            border-radius: 60% 40% 60% 40% / 60% 60% 40% 40%;
        }

        /* --- RESPONSIVO M칍VIL --- */
        @media (max-width: 700px) {
            .tree-container {
                width: 90vw !important;
                height: 90vw !important;
            }
            .tree-container svg.move-and-scale {
                transform: translateY(60px) scale(1.1);
            }
            .dedication-text {
                left: 50%;
                top: 8%;
                transform: translateX(-50%);
                width: 90vw;
                font-size: 1rem;
            }
            .countdown {
                font-size: 0.9rem;
                bottom: 8%;
            }
        }
    </style>
</head>
<body>

    <div id="floating-objects"></div>
    
    <div class="dedication-text" id="dedication-text">
        <div class="signature" id="signature"></div>
    </div>

    <div class="countdown" id="countdown"></div>
    
    <div class="tree-container" id="tree-container">
        </div>

    <audio id="bg-music" preload="auto" loop></audio>

    <script>
        // --- JAVASCRIPT UNIFICADO ---

        // 1. Cargar el SVG (Aseg칰rate que Img/treelove.svg est칠 en la misma carpeta)
        fetch('Img/treelove.svg')
          .then(res => res.text())
          .then(svgText => {
            const container = document.getElementById('tree-container');
            container.innerHTML = svgText;
            const svg = container.querySelector('svg');
            if (!svg) return;

            const allPaths = Array.from(svg.querySelectorAll('path'));
            allPaths.forEach(path => {
              path.style.stroke = '#222';
              path.style.strokeWidth = '2.5';
              path.style.fillOpacity = '0';
              const length = path.getTotalLength();
              path.style.strokeDasharray = length;
              path.style.strokeDashoffset = length;
            });

            setTimeout(() => {
              allPaths.forEach((path, i) => {
                path.style.transition = `stroke-dashoffset 1.2s cubic-bezier(.77,0,.18,1) ${i * 0.08}s, fill-opacity 0.5s ${0.9 + i * 0.08}s`;
                path.style.strokeDashoffset = 0;
                setTimeout(() => {
                  path.style.fillOpacity = '1';
                  path.style.stroke = '';
                }, 1200 + i * 80);
              });

              const totalDuration = 1200 + (allPaths.length - 1) * 80 + 500;
              setTimeout(() => {
                svg.classList.add('move-and-scale');
                setTimeout(() => {
                  showDedicationText();
                  startFloatingObjects();
                  showCountdown();
                  playBackgroundMusic();
                }, 1200);
              }, totalDuration);
            }, 50);

            const heartPaths = allPaths.filter(el => {
              const style = el.getAttribute('style') || '';
              return style.includes('#FC6F58') || style.includes('#C1321F');
            });
            heartPaths.forEach(path => path.classList.add('animated-heart'));
          });

        function getURLParam(name) {
          const url = new URL(window.location.href);
          return url.searchParams.get(name);
        }

        function showDedicationText() { 
          let text = getURLParam('text');
          if (!text) {
            text = `Para el Pecas:\n\nHola gordis :3 solo queria hacerte esta dedicacion y agradecerte de que seas mi amiwo.\n\neres un amigo increible w neta nunca cambies, se que no soy mucho de expresar mis sentimientos pero realmente te has vuelto alguien especial.\n\nEres un imbecil.... pero tambien eres una persona muy inteligente, amable y paciente. TKM MI AMOL :3`;
          } else {
            text = decodeURIComponent(text).replace(/\\n/g, '\n');
          }
          
          const container = document.getElementById('dedication-text');
          container.classList.add('typing');
          let i = 0;
          function type() {
            if (i <= text.length) {
              container.textContent = text.slice(0, i);
              i++;
              setTimeout(type, text[i - 2] === '\n' ? 350 : 45);
            } else {
              setTimeout(showSignature, 600);
            }
          }
          type();
        }

        function showSignature() {
          const dedication = document.getElementById('dedication-text');
          let signature = document.createElement('div');
          signature.id = 'signature';
          signature.className = 'signature';
          dedication.appendChild(signature);
          
          let firma = getURLParam('firma');
          signature.textContent = firma ? decodeURIComponent(firma) : "Con amor, El Murfirio";
          signature.classList.add('visible');
        }

        function startFloatingObjects() {
          const container = document.getElementById('floating-objects');
          let count = 0;
          function spawn() {
            let el = document.createElement('div');
            el.className = 'floating-petal';
            el.style.left = `${Math.random() * 90 + 2}%`;
            el.style.top = `${100 + Math.random() * 10}%`;
            container.appendChild(el);

            const duration = 6000 + Math.random() * 4000;
            setTimeout(() => {
              el.style.transition = `transform ${duration}ms linear, opacity 1.2s`;
              el.style.transform = `translate(${(Math.random() - 0.5) * 60}px, -110vh) rotate(${Math.random() * 360}deg)`;
              el.style.opacity = 0.2;
            }, 30);

            setTimeout(() => { if (el.parentNode) el.parentNode.removeChild(el); }, duration + 2000);
            if (count++ < 100) setTimeout(spawn, 400);
          }
          spawn();
        }

        function showCountdown() {
          const container = document.getElementById('countdown');
          let startDate = new Date('2024-08-08T00:00:00'); 
          let eventDate = new Date('2026-08-08T00:00:00');

          function update() {
            const now = new Date();
            let days = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
            let eDiff = eventDate - now;
            let eDays = Math.max(0, Math.floor(eDiff / (1000 * 60 * 60 * 24)));
            let eHrs = Math.max(0, Math.floor((eDiff / (1000 * 60 * 60)) % 24));
            let eMin = Math.max(0, Math.floor((eDiff / (1000 * 60)) % 60));
            let eSec = Math.max(0, Math.floor((eDiff / 1000) % 60));

            container.innerHTML = `Llevamos siendo gordos: <b>${days}</b> d칤as<br>` +
                                  `Pr칩ximo gordiniversario: <b>${eDays}d ${eHrs}h ${eMin}m ${eSec}s</b>`;
            container.classList.add('visible');
          }
          update();
          setInterval(update, 1000);
        }

        // --- Funci칩n de M칰sica Actualizada ---
function playBackgroundMusic() {
  const audio = document.getElementById('bg-music');
  let musicaParam = getURLParam('musica') || 'music1.mp3';
  audio.src = 'Music/' + musicaParam;
  audio.volume = 0.7;
  audio.loop = true;

  let btn = document.createElement('button');
  btn.innerHTML = '郊윒잺 M칰sica'; // Inicia con icono de play
  btn.style.cssText = 'position:fixed; bottom:18px; right:18px; z-index:99; background:rgba(255,255,255,0.9); border:none; border-radius:24px; padding:10px 18px; cursor:pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-family: sans-serif;';
  document.body.appendChild(btn);

  // Funci칩n para intentar reproducir
  const startAudio = () => {
    audio.play().then(() => {
      btn.innerHTML = '游댉 M칰sica';
      // Una vez que empieza a sonar, quitamos los escuchadores para no reiniciar
      window.removeEventListener('click', startAudio);
      window.removeEventListener('touchstart', startAudio);
    }).catch(err => console.log("Esperando interacci칩n..."));
  };

  // Escuchar clics o toques en cualquier parte de la pantalla
  window.addEventListener('click', startAudio);
  window.addEventListener('touchstart', startAudio);

  // Control manual del bot칩n
  btn.onclick = (e) => {
    e.stopPropagation(); // Evita que el clic del bot칩n active el listener global
    if (audio.paused) {
      audio.play();
      btn.innerHTML = '游댉 M칰sica';
    } else {
      audio.pause();
      btn.innerHTML = '游댇 M칰sica';
    }
  };
}
    </script>
</body>
</html>