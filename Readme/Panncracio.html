<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo: Gordiniversario</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Outfit:wght@300;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #050505;
            --accent-pink: #ff0055;
            --accent-orange: #ff8c00;
            --accent-yellow: #ffd700;
            --glass: rgba(20, 20, 20, 0.9);
            --text-color: #e0e0e0;
        }

        body { 
            margin: 0; 
            padding: 0; 
            width: 100vw; 
            height: 100vh; 
            overflow: hidden; 
            background: var(--bg-color); 
            font-family: 'Share Tech Mono', monospace;
            color: var(--text-color);
        }

        /* --- PANTALLA DE INICIO (LA BANANA HOLOGRÁFICA) --- */
        #welcome-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            cursor: pointer;
            transition: opacity 0.8s ease;
        }

        /* Fondo de rejilla estilo cyber para la banana */
        #welcome-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
        }

        .banana-svg {
            width: 140px;
            height: auto;
            /* Efecto Neón Dorado */
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
            animation: float-rock 2.5s ease-in-out infinite alternate;
            z-index: 2;
        }

        @keyframes float-rock {
            0% { transform: translateY(0) rotate(-5deg); }
            100% { transform: translateY(-20px) rotate(5deg); }
        }

        .click-text {
            margin-top: 40px;
            font-size: 1.5rem;
            color: var(--accent-yellow);
            letter-spacing: 4px;
            font-weight: bold;
            text-transform: uppercase;
            animation: glitch-blink 2s infinite;
            border: 1px solid var(--accent-yellow);
            padding: 10px 20px;
            background: rgba(255, 215, 0, 0.05);
            z-index: 2;
        }

        @keyframes glitch-blink {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--accent-yellow); }
            50% { opacity: 0.7; box-shadow: none; }
            52% { opacity: 0.2; }
            54% { opacity: 0.7; }
        }

        /* --- EL ÁRBOL HOLOGRÁFICO --- */
        .tree-container { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 520px; 
            height: 520px; 
            z-index: 2; 
            display: none; 
            /* Filtro para que el SVG brille como neón */
            filter: drop-shadow(0 0 5px var(--accent-pink));
        }
        
        .tree-container svg { width: 100%; height: 100%; display: block; }
        .tree-container svg path { transition: fill-opacity 0.5s, stroke-dashoffset 1.2s; }
        
        .tree-container svg.move-and-scale { 
            transition: transform 1.2s cubic-bezier(.77,0,.18,1); 
            transform: translateX(200px) scale(1.35); 
        }
        
        .animated-heart { 
            transform-origin: center; 
            animation: beat 1s infinite; 
            filter: drop-shadow(0 0 8px red);
        }
        @keyframes beat { 0%, 100% { transform: scale(1); } 20% { transform: scale(1.1); } 40% { transform: scale(0.95); } 60% { transform: scale(1.08); } 80% { transform: scale(1); } }
        
        /* --- DEDICATORIA ESTILO TERMINAL --- */
        .dedication-text { 
            position: absolute; 
            top: 50%; 
            left: 5%; 
            transform: translateY(-50%); 
            min-width: 320px; 
            max-width: 600px; 
            font-size: 1.2rem; 
            color: #fff; 
            font-family: 'Share Tech Mono', monospace; 
            white-space: pre-line; 
            z-index: 3; 
            opacity: 0; 
            /* Estilo Cristal Oscuro */
            background: var(--glass);
            border: 1px solid var(--accent-pink);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.15);
            border-radius: 8px; 
            padding: 2em; 
            transition: opacity 0.6s; 
        }

        /* Línea decorativa arriba de la carta */
        .dedication-text::before {
            content: ">>> INCOMING MESSAGE...";
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-color);
            color: var(--accent-pink);
            padding: 0 10px;
            font-size: 0.8rem;
            letter-spacing: 2px;
        }
        
        .signature { 
            margin-top: 1.5em; 
            font-size: 1.8rem; 
            color: var(--accent-orange); 
            opacity: 0; 
            transition: opacity 0.7s; 
            text-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
        }
        .signature.visible { opacity: 1; }
        
        /* --- CONTADOR --- */
        .countdown { 
            position: fixed; 
            left: 50%; 
            bottom: 5%; 
            transform: translateX(-50%) translateY(30px); 
            font-family: 'Share Tech Mono', monospace; 
            font-size: 1.2rem; 
            color: #ccc; 
            background: rgba(0, 0, 0, 0.8); 
            border: 1px solid #333;
            padding: 1em 2em; 
            border-radius: 4px; 
            z-index: 6; 
            text-align: center; 
            opacity: 0; 
            transition: all 0.8s cubic-bezier(.77,0,.18,1); 
        }
        .countdown b {
            color: var(--accent-orange);
            font-size: 1.4rem;
        }
        .countdown.visible { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        /* --- OBJETOS FLOTANTES (AHORA DIGITALES) --- */
        #floating-objects { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 10; }
        
        /* En lugar de pétalos redondos, cuadrados neón */
        .floating-petal { 
            position: absolute; 
            width: 15px; 
            height: 15px; 
            background: rgba(255, 0, 85, 0.4); 
            border: 1px solid var(--accent-pink);
            box-shadow: 0 0 10px var(--accent-pink);
        }
        
        /* CANVAS DE FONDO (Si quieres usar el efecto de corazones/partículas anterior) */
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.3; }

        @media (max-width: 800px) {
            .tree-container { width: 90vw !important; height: 90vw !important; opacity: 0.3; }
            .tree-container svg.move-and-scale { transform: translate(0, 0) scale(1); }
            .dedication-text { left: 50%; top: 50%; transform: translate(-50%, -50%); width: 90vw; font-size: 1rem; background: rgba(0,0,0,0.95); }
            .countdown { font-size: 0.8rem; width: 90%; bottom: 2%; }
        }
    </style>
</head>
<body>

    <div id="welcome-screen" onclick="initExperience()">
        <svg class="banana-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="#FFD700" d="M440.5,345.6c-7.6-13.6-14.8-26.8-21.6-39.6C389.5,253.4,344.6,169,258.7,97c-25.6-21.5-56.8-41-90.2-57.1 C152.5,32.3,135.8,25,119.3,18.6L99.9,11c-7-2.8-14.8-0.3-18.9,6.1C76.9,23.4,74,30.8,73.2,38.3c-0.6,5.8-0.3,11.7,1,17.4 c2.2,9.4,21.9,74.5,64.3,144.3c35.2,58,77.4,108.9,125.4,151.3c36.6,32.3,75.9,58.4,116.8,77.6c7.3,3.4,14.7,6.6,22.3,9.3 c14.5,5.2,30.8,8.2,47.7,8.6c6.8,0.2,13.3-3.1,17.3-8.7c3.9-5.6,4.9-13,2.5-19.3L440.5,345.6z"/>
            <path fill="#8B4513" d="M119.3,18.6L99.9,11c-7-2.8-14.8-0.3-18.9,6.1C73.9,28.1,85.6,80,119.3,18.6z"/>
            <path fill="#8B4513" d="M470.5,420.1c-14.5-5.2-21.9-16.9-30-30.5l30,30.5c6.8,0.2,13.3-3.1,17.3-8.7 C490,406,483,415,470.5,420.1z"/>
        </svg>
        <div class="click-text">>>> TOCA LA BANANA <<<</div>
    </div>

    <div id="floating-objects"></div>
    
    <div class="dedication-text" id="dedication-text"><div class="signature" id="signature"></div></div>
    
    <div class="countdown" id="countdown"></div>
    
    <div class="tree-container" id="tree-container"></div>
    
    <audio id="bg-music" loop></audio>

    <script>
        let experienceStarted = false;

        function initExperience() {
            if (experienceStarted) return;
            experienceStarted = true;

            const welcome = document.getElementById('welcome-screen');
            welcome.style.opacity = '0';
            setTimeout(() => {
                welcome.style.display = 'none';
                document.getElementById('tree-container').style.display = 'block';
                startTreeAnimation();
            }, 800);

            // MÚSICA
            const audio = document.getElementById('bg-music');
            let musicaParam = new URL(window.location.href).searchParams.get('musica') || 'music1.mp3';
            // Asegúrate que la ruta sea correcta según tu estructura de carpetas
            audio.src = 'Music/' + musicaParam; 
            audio.volume = 0.8;
            audio.play().catch(e => console.log("Interacción requerida para audio"));
        }

        function startTreeAnimation() {
            // Asegúrate que 'Img/treelove.svg' exista en tu carpeta Img
            fetch('Img/treelove.svg')
              .then(res => res.text())
              .then(svgText => {
                const container = document.getElementById('tree-container');
                container.innerHTML = svgText;
                const svg = container.querySelector('svg');
                if (!svg) return;

                const allPaths = Array.from(svg.querySelectorAll('path'));
                allPaths.forEach(path => {
                  // CAMBIO: Trazos color neón rosa en lugar de negro
                  path.style.stroke = '#ff0055'; 
                  path.style.strokeWidth = '3';
                  path.style.fillOpacity = '0';
                  const length = path.getTotalLength();
                  path.style.strokeDasharray = length;
                  path.style.strokeDashoffset = length;
                });

                setTimeout(() => {
                  allPaths.forEach((path, i) => {
                    path.style.transition = `stroke-dashoffset 1.2s cubic-bezier(.77,0,.18,1) ${i * 0.08}s, fill-opacity 0.5s ${0.9 + i * 0.08}s`;
                    path.style.strokeDashoffset = 0;
                    setTimeout(() => {
                      // CAMBIO: Al rellenarse, usar un color blanco/rosado brillante
                      path.style.fill = '#ffe6ea'; 
                      path.style.fillOpacity = '1';
                      path.style.stroke = '';
                    }, 1200 + i * 80);
                  });

                  setTimeout(() => {
                    svg.classList.add('move-and-scale');
                    setTimeout(() => {
                      showDedicationText();
                      startFloatingObjects(); // Ahora son glitch/datos
                      showCountdown();
                    }, 1200);
                  }, 1200 + (allPaths.length * 80));
                }, 100);

                const heartPaths = allPaths.filter(el => (el.getAttribute('style') || '').match(/#FC6F58|#C1321F/));
                heartPaths.forEach(p => p.classList.add('animated-heart'));
              });
        }

        function showDedicationText() {
            let text = `Para el Pecas:\n\nHola gordis :3 solo queria hacerte esta dedicacion y agradecerte de que seas mi amiwo.\n\neres un amigo increible w neta nunca cambies, se que no soy mucho de expresar mis sentimientos pero realmente te has vuelto alguien especial, gracias a ti he aprendido y cambiado muchas cosas.\n\nEres un imbecil.... pero tambien eres una persona muy inteligente, sincero, gracioso, amable, paciente, autentico, TERCO xDD, pero eres mi imbecil :3\n\nTKM MI AMOL :3`;
            
            const urlText = new URL(window.location.href).searchParams.get('text');
            if(urlText) text = decodeURIComponent(urlText).replace(/\\n/g, '\n');

            const container = document.getElementById('dedication-text');
            container.style.opacity = '1';
            let i = 0;
            function type() {
                if (i <= text.length) {
                    // Usamos innerText para respetar saltos de linea
                    container.innerText = text.slice(0, i);
                    i++;
                    setTimeout(type, text[i-2] === '\n' ? 350 : 45);
                } else { showSignature(); }
            }
            type();
        }

        function showSignature() {
            const dedication = document.getElementById('dedication-text');
            let sig = document.createElement('div');
            sig.className = 'signature visible';
            sig.textContent = "Con amor, El Murfirio";
            dedication.appendChild(sig);
        }

        function startFloatingObjects() {
            const container = document.getElementById('floating-objects');
            setInterval(() => {
                let el = document.createElement('div');
                el.className = 'floating-petal';
                el.style.left = Math.random() * 100 + '%';
                el.style.top = '100%';
                
                // Variación de colores neón
                const colors = ['#ff0055', '#ff8c00', '#00ffcc'];
                el.style.borderColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.background = 'transparent';

                container.appendChild(el);
                const duration = 4000 + Math.random() * 4000;
                
                // Animación hacia arriba (datos subiendo a la nube)
                el.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 0.8 },
                    { transform: `translateY(-110vh) rotate(360deg)`, opacity: 0 }
                ], { duration: duration, easing: 'linear' });
                
                setTimeout(() => el.remove(), duration);
            }, 300);
        }

        function showCountdown() {
            const container = document.getElementById('countdown');
            
            // FECHAS (No modificadas)
            const startDate = new Date('2024-08-08T00:00:00');
            const eventDate = new Date('2026-08-08T00:00:00');

            function update() {
                const now = new Date();
                
                let diff = now - startDate;
                let days = Math.floor(diff / (1000 * 60 * 60 * 24));

                let eventDiff = eventDate - now;
                let eventDays = Math.max(0, Math.floor(eventDiff / (1000 * 60 * 60 * 24)));
                let eventHours = Math.max(0, Math.floor((eventDiff / (1000 * 60 * 60)) % 24));
                let eventMinutes = Math.max(0, Math.floor((eventDiff / (1000 * 60)) % 60));
                let eventSeconds = Math.max(0, Math.floor((eventDiff / 1000) % 60));

                container.innerHTML =
                    `Llevamos siendo gordos juntos: <b>${days}</b> días<br>` +
                    `<span style="color:#666">---------------------------</span><br>` +
                    `Nuestro gordiniversario: <b>${eventDays}d ${eventHours}h ${eventMinutes}m ${eventSeconds}s</b>`;
                
                container.classList.add('visible');
            }

            update(); 
            setInterval(update, 1000); 
        }
    </script>
</body>
</html>